apiVersion: apps/v1
kind: Deployment
metadata:
  name: redisinsight
  namespace: __NAMESPACE__
spec:
  replicas: 1
  selector:
    matchLabels:
      app: redisinsight
  template:
    metadata:
      labels:
        app: redisinsight
    spec:
      containers:
        - name: redisinsight
          image: redis/redisinsight:__IMAGE_VERSION_REDISINSIGHT__
          ports:
            - containerPort: 5540
          env:
            # Preconfigure the connection in RedisInsight (see Redis docs: RI_REDIS_*).
            # NOTE: If these env vars are removed later, RedisInsight may remove previously added connections.
            # Use explicit ID suffix for maximum compatibility (some versions only recognize the indexed form).
            - name: RI_ENCRYPTION_KEY
              valueFrom:
                secretKeyRef:
                  name: redisinsight-encryption
                  key: encryption-key
            - name: RI_REDIS_HOST_0
              value: "__REDIS_HOST__"
            - name: RI_REDIS_PORT_0
              value: "__REDIS_PORT__"
            - name: RI_REDIS_ALIAS_0
              value: "__REDIS_ALIAS__"
            - name: RI_REDIS_USERNAME_0
              value: "default"
            - name: RI_REDIS_PASSWORD_0
              valueFrom:
                secretKeyRef:
                  name: redis
                  key: redis-password
          volumeMounts:
            - name: redisinsight-data
              mountPath: /data
      volumes:
        - name: redisinsight-data
          persistentVolumeClaim:
            claimName: redisinsight-pvc


